<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Email | DSG PERU TECHNOLOGY</title>
    <meta name="description" content="Verifica tu dirección de correo electrónico">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/global/index.css">
    <link rel="stylesheet" href="/assets/css/pages/auth.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="/assets/images/icons/logo_3.1.png" type="image/png">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Header -->
            <div class="auth-header">
                <div class="logo">
                    <img src="/assets/images/logos/logo_3.1.png" alt="DSG PERU TECHNOLOGY">
                    <h1>DSG PERU TECHNOLOGY</h1>
                </div>
                <h2>Verificar Email</h2>
                <p>Confirma tu dirección de correo electrónico</p>
            </div>

            <!-- Verification Status -->
            <div class="verification-content" id="verification-content">
                <!-- Pending Verification -->
                <div class="verification-state pending" id="pending-state">
                    <i data-lucide="mail" style="width: 64px; height: 64px; color: var(--primary-color); margin-bottom: 1.5rem;"></i>
                    <h3>Revisa tu Email</h3>
                    <p>Hemos enviado un enlace de verificación a:</p>
                    <div class="email-display" id="email-display">
                        <strong>usuario@ejemplo.com</strong>
                    </div>
                    <p>Haz clic en el enlace del email para verificar tu cuenta.</p>
                    
                    <div class="verification-actions">
                        <button class="btn btn-outline btn-full" id="resend-email">
                            <i data-lucide="refresh-cw"></i>
                            <span>Reenviar Email</span>
                        </button>
                        <button class="btn btn-primary btn-full" id="check-verification">
                            <i data-lucide="check-circle"></i>
                            <span>Ya Verifiqué</span>
                        </button>
                    </div>
                </div>

                <!-- Verification Success -->
                <div class="verification-state success" id="success-state" style="display: none;">
                    <i data-lucide="check-circle" style="width: 64px; height: 64px; color: #22c55e; margin-bottom: 1.5rem;"></i>
                    <h3>¡Email Verificado!</h3>
                    <p>Tu dirección de correo ha sido verificada exitosamente.</p>
                    <p>Ya puedes acceder a todas las funciones de tu cuenta.</p>
                    
                    <div class="verification-actions">
                        <a href="/pages/auth/client-login.html" class="btn btn-primary btn-full">
                            <i data-lucide="log-in"></i>
                            <span>Iniciar Sesión</span>
                        </a>
                    </div>
                </div>

                <!-- Verification Error -->
                <div class="verification-state error" id="error-state" style="display: none;">
                    <i data-lucide="x-circle" style="width: 64px; height: 64px; color: #ef4444; margin-bottom: 1.5rem;"></i>
                    <h3>Error de Verificación</h3>
                    <p>No pudimos verificar tu email. El enlace puede haber expirado.</p>
                    
                    <div class="verification-actions">
                        <button class="btn btn-primary btn-full" id="retry-verification">
                            <i data-lucide="refresh-cw"></i>
                            <span>Intentar Nuevamente</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Help Section -->
            <div class="help-section">
                <h4>¿No recibiste el email?</h4>
                <ul>
                    <li>Revisa tu carpeta de spam o correo no deseado</li>
                    <li>Asegúrate de que la dirección de email sea correcta</li>
                    <li>El enlace expira en 24 horas</li>
                    <li>Contacta soporte si continúas teniendo problemas</li>
                </ul>
            </div>

            <!-- Footer -->
            <div class="auth-footer">
                <p><a href="#" id="change-email">¿Email incorrecto? Cambiar dirección</a></p>
                <p><a href="/index.html">← Volver al inicio</a></p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            // Get email from URL params or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email') || localStorage.getItem('pendingEmail') || 'usuario@ejemplo.com';
            const token = urlParams.get('token');
            
            document.getElementById('email-display').innerHTML = `<strong>${email}</strong>`;
            
            // If token is present, verify automatically
            if (token) {
                verifyEmail(token);
            }
            
            // Resend email
            document.getElementById('resend-email').addEventListener('click', function() {
                const btn = this;
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin"></i><span>Enviando...</span>';
                btn.disabled = true;
                lucide.createIcons();
                
                setTimeout(() => {
                    btn.innerHTML = '<i data-lucide="check"></i><span>Email Enviado</span>';
                    btn.style.background = '#22c55e';
                    btn.style.borderColor = '#22c55e';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        btn.style.background = '';
                        btn.style.borderColor = '';
                        lucide.createIcons();
                    }, 3000);
                }, 2000);
            });
            
            // Check verification
            document.getElementById('check-verification').addEventListener('click', function() {
                verifyEmail('manual-check');
            });
            
            // Retry verification
            document.getElementById('retry-verification').addEventListener('click', function() {
                showState('pending');
            });
            
            // Change email
            document.getElementById('change-email').addEventListener('click', function(e) {
                e.preventDefault();
                const newEmail = prompt('Ingresa tu nueva dirección de email:', email);
                if (newEmail && newEmail !== email) {
                    document.getElementById('email-display').innerHTML = `<strong>${newEmail}</strong>`;
                    localStorage.setItem('pendingEmail', newEmail);
                    showState('pending');
                }
            });
            
            function verifyEmail(token) {
                // Simulate verification process
                const btn = document.getElementById('check-verification');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin"></i><span>Verificando...</span>';
                btn.disabled = true;
                lucide.createIcons();
                
                setTimeout(() => {
                    // Simulate random success/failure
                    const success = Math.random() > 0.3; // 70% success rate
                    
                    if (success) {
                        showState('success');
                        localStorage.removeItem('pendingEmail');
                    } else {
                        showState('error');
                    }
                }, 2000);
            }
            
            function showState(state) {
                const states = ['pending', 'success', 'error'];
                states.forEach(s => {
                    const element = document.getElementById(`${s}-state`);
                    element.style.display = s === state ? 'block' : 'none';
                });
            }
        });
    </script>
    
    <style>
        .verification-content {
            text-align: center;
            padding: 2rem 0;
        }
        
        .verification-state h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }
        
        .verification-state p {
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
        }
        
        .email-display {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
        }
        
        .verification-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .help-section {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: left;
        }
        
        .help-section h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        .help-section ul {
            margin: 0;
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }
        
        .help-section li {
            margin-bottom: 0.5rem;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>